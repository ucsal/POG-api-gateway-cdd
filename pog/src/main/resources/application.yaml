server:
  port: ${ENV_SERVER_PORT:8080}

spring:
  application:
    name: api-gateway

  profiles:
    active: ${ENV_SPRING_PROFILES_ACTIVE:dev}

  config:
    import: "optional:configserver:${ENV_CONFIG_SERVER_URL:http://config-server:8888}"

  cloud:
    gateway:
      ignored-patterns:
        - /actuator/**
      mvc:
        excluded:
          - /actuator/**
      routes:
        - id: academico-service
          uri: ${ENV_ACADEMICO_URL:http://localhost:8081}
          predicates:
            - Path=/cursos/**
            - Path=/disciplinas/**
            - Path=/escolas/**
            - Path=/matrizes/**
          filters:
            - StripPrefix=1

        - id: programa-service
          uri: ${ENV_PROGRAMA_URL:http://localhost:8082}
          predicates:
            - Path=/api/atualizacoes/**
            - Path=/api/bibliografias/**
            - Path=/api/programas/**
          filters:
            - StripPrefix=1

        - id: auth-service
          uri: ${ENV_AUTH_URL:http://localhost:8083}
          predicates:
            - Path=/api/auth/**
          filters:
            - StripPrefix=1

      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Origin, RETAIN_FIRST
        - AddResponseHeader=Access-Control-Allow-Origin, "*"
        - AddResponseHeader=Access-Control-Allow-Credentials, "true"
        - AddResponseHeader=Access-Control-Allow-Methods, "GET, POST, PUT, DELETE, OPTIONS"
        - AddResponseHeader=Access-Control-Allow-Headers, "Content-Type, Authorization"

      cors:
        allowed-origins: "*"
        allowed-methods: "*"
        allowed-headers: "*"
        allow-credentials: true

      httpclient:
        connect-timeout: 5000
        response-timeout: 5000ms

      discovery:
        locator:
          enabled: true
          lower-case-service-id: true

management:
  endpoints:
    web:
      exposure:
        include: "*"

  health:
    show-details: always
